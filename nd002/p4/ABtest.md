A/B测试项目：免费试学筛选器
===

email：waynewqh@foxmail.com

试验概述
---
---

在进行此试验时，优达学城当前的主页上有两个选项：“开始免费试学”和“访问课程资料”。如果学生点击“开始免费试学”，系统将要求他们输入信用卡信息，然后他们将进入付费课程版本的免费试学。14 天后，将对他们自动收费，除非他们在此期限结束前取消试用。若学生点击“访问课程材料”，他们将能够观看视频和免费进行小测试，但是他们不会获得导师指导支持或验证证书，无法提交最终项目来获取反馈。

在此试验中，优达学城测试了一项变化，如果学生点击“开始免费试学”，系统会问他们有多少时间投入到这个课程中。如果学生表示每周 5 小时或更多，将按常规程序进行登录。如果他们表示一周不到 5 小时，将出现一条消息说明优达学城的课程通常需要更多的时间投入才能成功完成，并建议学生可免费访问课程资料。在这里，学生可选择继续进行免费试学，或免费访问课程资料。

我们的假设是这会为学生预先设定明确的期望，从而减少因为没有足够的时间而离开免费试学，并因此受挫的学生数量，同时不会在很大程度上减少继续通过免费试学和最终完成课程的学生数量。如果这个假设最后为真，优达学城将改进整体学生体验和提高导师为能够完成课程的学生提供支持的能力。

引流单位为 cookie，尽管学生参加的是免费试学，但在登录后他们的用户 id 便被跟踪。同一个用户 id 不能两次参加免费试学。对于不参加免费试学的用户，他们的用户 id 不会在试验中被跟踪，即使他们在访问课程概述页面时登录了网站。

试验设计
---
---
###指标选择

在本次试验中，我们一共有7个指标可供选择：
（注：任何提及“唯一 cookie”的地方，其唯一性按天决定。（在两个不同日期进行访问的同一个cookie 将计算两次。）用户 id 自动唯一，因为网站不允许同一个用户 id 参与两次。）
* **cookie 的数量**：即查看课程概述页面的唯一 cookie 的数量。($d_{min}=3000$)
* **用户 id 的数量**：即报名参加免费试用的用户数量。($d_{min}=50$)
* **点击次数**：即点击“开始免费试用”按钮（在免费试用屏幕触发前发生）的唯一 cookie 的数量。($d_{min}=240$)
* **点进概率**：即点击“开始免费试用”按钮的唯一 cookie 除以查看课程概述页面的唯一 cookie 的数量所得的结果。($d_{min}=0.01$)
* **总转化率**：即完成登录并报名参加免费试用的用户 id 的数量除以点击“开始免费试用”按钮的唯一 cookie 的数量所得的结果。($d_{min}=0.01$)
* **留存率**：即在 14 天期限后仍保持参加（并进行了至少一次支付）的用户 id 的数量除以完成登录的用户 id 的数量。($d_{min}=0.01$)
* **净转化率**：即在 14 天期限结束后仍然参加（并至少进行了一次支付）的用户 id 的数量除以点击“开始免费试用”按钮的唯一 cookie 的数量所得的结果。($d_{min}=0.0075$)

对于每一个指标，分析如下：
* **cookie的数量**：cookie作为本次试验的引流单位，能随机分配到对照组和实验组，因此是个很好的总体规模不变指标。
* **用户id的数量**：由于用户会被试验所影响，某部分用户会被试验提示而放弃免费试学，用户id并不能做到随机分配到对照组和实验组，因此并不是一个好的不变指标。同样地用户id数由于页面浏览人数的影响的变化可能很大，没有进行归一化处理，不适合作为评估指标。
* **点击次数**：点击按钮发生在试验事件之前，不会被试验所影响，因此也是一个很好的总体规模不变指标。
* **点进概率**：指标的两个变量都是不变指标，因此这也是一个很好的不变指标。
* **总转化率**：这个指标的一个变量用户id数量并不是不变指标，因此也不是好的不变指标。指标分析单位和试验的引流单位都是cookie，因此指标的分析和实证间的差异性不大，是个很好的评估指标。
* **留存率**：付费用户id数量受免费试学用户id数量所影响，因此并不是好的不变指标。由于本次试验希望能通过筛选器减少没有足够时间完成免费试学的用户，同时不减少完成免费试学并最终付费完成课程的用户，基于业务的考量这是一个很好的评估指标。
* **净转化率**：理由基本同上，是一个很好的评估指标。

所以我们选择的不变指标和评估指标为：
不变指标：**cookie的数量**、**点击次数**、**点进概率**。
评估指标：**总转化率**、**留存率**、**净转化率**。

###评估指标的期望

本次试验在点击“开始免费试学”之后增加一个对于用户自己学习时间期望投入的筛选器，通过筛选器事件，能够排除掉投入时间较少难以完成免费试学课程的用户，从而使完成登录的用户有所降低，但经过筛选器登陆免费试学的用户更有可能完成免费课程。同时由于我们不希望减少继续通过免费试学和最终完成课程的学生数量，因此我们期望试验里：
* **总转化率**：会降低，分子报名免费试学的用户id数期望减少，分母是总体规模不变指标。
* **留存率**：会提高，分子付费用户id的数量期望不减少，分母报名免费试学的用户id数期望减少。
* **净转化率**：不降低，分子付费用户id的数量期望不减少，分母是总体规模不变指标。

###测量标准偏差

[此电子表格](https://s3.cn-north-1.amazonaws.com.cn/static-documents/nd002/Final+Project+Baseline+Values.xlsx)包含了由优达学城的真实数字变化而来的三个指标的基准值的粗略估计，每天浏览cookie数为40000，每天点击“开始免费试学”按钮数为3200，每天报名免费试学数为660。
假设有 5000 个 cookie 样本大小访问课程概述页面的情况下，利用分析法估计的标准偏差如下（保留4位小数）：

* **总转化率**：表格给出概率为$p=\frac{660}{3200}=0.2065$，样本点击按钮cookie数有$n=0.08*5000=400$。
所以其标准偏差为$SD=\sqrt{\frac{p*(1-p)}{n}}=\sqrt{\frac{0.2065*(1-0.2065)}{400}}=0.0202$。

* **留存率**：表格给出概率为$p=0.53$，样本登记报名数有$n=\frac{660}{40000}*5000=82.5$。
所以其标准偏差为$SD=\sqrt{\frac{p*(1-p)}{n}}=\sqrt{\frac{0.53*(1-0.53)}{82.5}}=0.0549$。

* **净转化率**：表格给出概率为$p=0.53*0.2065=0.1093$，样本点击按钮cookie数有$n=0.08*5000=400$。
所以其标准偏差为$SD=\sqrt{\frac{p*(1-p)}{n}}=\sqrt{\frac{0.1093*(1-0.1093)}{400}}=0.0156$。

由于总转化率和净转化率的分析单位与试验的引流单位同是cookie，因此这两个指标的分析标准偏差和实证标准偏差的差异性较少。留存率的分析单位是用户id与引流单位不同，因此分析和经验的差异性可能会很大，如果时间充足，最好进行经验估计。

###规模
####样本数量和功效

我认为在分析测试里并不需要作Bonferroni校正，因为这会使所需的样本页面浏览数大大增加，在试验里显得过于保守，而且我们只有三个评估指标，并不足以造成太多比例的假阳性结果，因此我们只需要假设各个指标之间是独立的。下面通过[在线计算器](http://www.evanmiller.org/ab-testing/sample-size.html)计算评估指标所需的样本页面浏览数。

* **总转化率**：在基准变化率20.625%，实际显著性即最小可检测效果$d_{min}$为1%，统计显著性水平$\alpha$为5%，统计功效$1-\beta$为80%，可得样本大小为25835，分析单位为cookie数。我们需要转化为页面浏览数，同时要考虑对照组和实验组两个组的样本应该基本相同，根据[此电子表格](https://s3.cn-north-1.amazonaws.com.cn/static-documents/nd002/Final+Project+Baseline+Values.xlsx)的估算，因此有样本页面浏览数$N=25835*2*\frac{40000}{3200}=645875$。

* **留存率**：在基准变化率53%，实际显著性即最小可检测效果$d_{min}$为1%，统计显著性水平$\alpha$为5%，统计功效$1-\beta$为80%，可得样本大小为39115，分析单位为报名免费课程的登陆用户id数量。因此有样本页面浏览数$N=39115*2*\frac{40000}{600}=4741212$。

* **净转化率**：在基准变化率10.93125%，实际显著性即最小可检测效果$d_{min}$为0.75%，统计显著性水平$\alpha$为5%，统计功效$1-\beta$为80%，可得样本大小为27411，分析单位为报名免费课程的登陆用户id数量。因此有样本页面浏览数$N=27411*2*\frac{40000}{3200}=685325$。

由于我们估计每天只有40000的页面浏览数，而要满足留存率所需的样本数4741212至少需要119天，对于一场A/B测试来说所需时间太长承担风险太大，不太合理，因此我们采纳685325作为我们本次测试的样本数。

####持续时间和曝光比例

本次试验并没有太大的风险：

* 即使学生每周学不到五小时，他们只是被页面的变更提醒引导到了另外的一个页面，如果今后有需要学生仍然可以进入免费试学、登陆并可能完成继续课程的，不会因此影响用户使用网站的习惯。
* 没有在页面展示上有过大的改动，不会对用户产生感情上的冲击，用户也不需要花长时间去适应页面的改变。
* 该试验没有关于数据库及后台的改变，不用担心数据的丢失及由于后台的失误导致网页奔溃用户无法访问网页等大问题。
* 此试验也不会对用户的个人信息安全造成风险，因为不论网页是否增加了提醒，用户在确认参加免费试学时都得输入信用卡信息，而很明显系统一定会保护用户的个人信息。
* 该试验同样也没有道德上的风险。

为了尽快完成试验，因此我希望转移全部流量进入本次试验，所需要的时间估算为$\frac{685325}{40000}=17.13$，即约需要18天。

试验分析
---
---
###合理性检查

完成了试验后，我们得到了[试验数据表格](https://s3.cn-north-1.amazonaws.com.cn/static-documents/nd002/Final+Project+Results.xlsx)。在我们开始分析工作前，先来检查**cookie数量**、**点击次数**和**点进概率**的合理性，我们使用的置信水平是95%，因此对应的Z临界值为1.96。如果需要通过合理性检查，试验引流的数据应该会平均分布到对照组和实验组，两者的实际比例应各落在分析比例$p=0.5$的95%置信区间内。

* **cookie的数量：**
样本页面浏览数量的标准误差为
$SE=\sqrt{\frac{p*(1-p)}{N_{total}}}=\sqrt{\frac{0.5*(1-0.5)}{690203}}=0.0006$
误差范围为
$m=Z*SE=1.96*0.0006=0.0012$
因此置信区间$p\pm m$为$(0.4988,5012)$
而试验里控制组页面浏览样本在总样本的比例为
$\hat{p_c}=\frac{N_{cont}}{N_{total}}=0.5006$
实验组的实际比例为
$\hat{p_e}=\frac{N_{exp}}{N_{total}}=0.4994$
两者皆落在落在置信区间内，因此cookie的数量这一不变指标通过合理性检查。

* **点击次数：**
样本点击数量的标准误差为
$SE=\sqrt{\frac{p*(1-p)}{N_{total}}}=\sqrt{\frac{0.5*(1-0.5)}{56703}}=0.0021$
误差范围为
$m=Z*SE=1.96*0.0021=0.0041$
因此置信区间$p\pm m$为$(0.4959,5041)$
控制组样本点击数在总样本的比例为
$\hat{p_c}=\frac{N_{cont}}{N_{total}}=0.5005$
实验组的实际比例为
$\hat{p_e}=\frac{N_{exp}}{N_{total}}=0.4995$
两者皆落在落在置信区间内，因此点击次数这一不变指标通过合理性检查。

* **点进概率：**
对于比较对照组和实验组的点进概率是否出现了统计上的显著性差异，我们可以建立零假设两者的点进概率没有差异，双尾检验置信水平为95%，由于样本足够大，因此两者之差应该遵从正态分布。
$H_0:p_{cont}-p_{exp}=0$
$H_A:p_{cont}-p_{exp}\ne0$
$\alpha=0.05,two-tailed$
$N_{cont}=345543,N_{exp}=344660,X_{cont}=28375,X_{exp}=28325$
我们希望通过样本的合并概率来推断总体概率，合并概率为：
$\hat{p}_{pool}=\frac{X_{cont}+X_{exp}}{N_{cont}+N_{exp}}=\frac{28375+28325}{345543+344660}=0.0822$
因此有合并标准误差：
$SE_{pool}=\sqrt{\hat{p}_{pool}*(1-\hat{p}_{pool})*(\frac{1}{N_{cont}}+\frac{1}{N_{exp}})}=0.00066$
$\alpha=0.05$的Z临界值为$Z^*=1.96$
通过样本我们预计两组间的概率统计差异为
$\hat{d}=\hat{p}_{cont}-\hat{p}_{exp}=\frac{X_{cont}}{N_{cont}}-\frac{X_{exp}}{N_{exp}}=-0.000057$
而假设的差异$d=p_{cont}-p_{exp}=0$
置信区间$d\pm Z^**SE_{pool}$为$(-0.0013,0.0013)$
由于$\hat{d}$落在置信区间里，因此我们可以维持零假设，即认为对照组和实验组的点进概率没有统计上的显著差异，点进概率这一指标可以通过合理性检查。

###结果分析
####效应大小检验
对于我们的评估指标，由于检验留存率所需样本规模要大于本次测试的样本数，所以不作为本次检验的评估指标。接下来我们对总转化率和净转化率在对照组和实验组之间的差异进行检验，来观察是否具有统计显著性和实际显著性，我们将进行双尾检验，置信水平为95%。
* **总转化率：**
建立零假设，总转化率在对照组和实验组之间没有差异。
$H_0:p_{exp}-p_{cont}=0$
$H_A:p_{exp}-p_{cont}\ne0$
$\alpha=0.05,two-tailed,d_{min}=0.01$
$N_{cont}=17293,N_{exp}=17260,X_{cont}=3785,X_{exp}=3423$
由于没有总体参数，因此假设利用样本参数来推断总体情况，有：
$\hat{d}=\hat{p}_{exp}-\hat{p}_{cont}=\frac{X_{exp}}{N_{exp}}-\frac{X_{cont}}{N_{cont}}=-0.0125$
$\hat{p}_{pool}=\frac{X_{cont}+X_{exp}}{N_{cont}+N_{exp}}=0.1271$
因此有合并标准误差：
$SE_{pool}=\sqrt{\hat{p}_{pool}*(1-\hat{p}_{pool})*(\frac{1}{N_{cont}}+\frac{1}{N_{exp}})}=0.00437$
$\alpha=0.05$的Z临界值为$Z^*=1.96$
置信区间$\hat{d}\pm Z^**SE_{pool}$为$(-0.0291,-0.012)$
由于$d=0$并不在置信区间内，因此我们可以拒绝零假设，接受对立假设，即实验组和对照组之间具有统计显著性。
在评估指标期望里，我们对总转化率的期望是会降低，即希望能得出阴性的统计显著性，并且我们希望观察到至少1%的变化，而置信区间既小于0也小于-0.01，因此对于总转化率我们的试验既有统计显著性也有实际显著性。

* **净转化率：**
建立零假设，总转化率在对照组和实验组之间没有差异。
$H_0:p_{exp}-p_{cont}=0$
$H_A:p_{exp}-p_{cont}\ne0$
$\alpha=0.05,two-tailed,d_{min}=0.0075$
$N_{cont}=17293,N_{exp}=17260,X_{cont}=2033,X_{exp}=1945$
由于没有总体参数，因此假设利用样本参数来推断总体情况，有：
$\hat{d}=\hat{p}_{exp}-\hat{p}_{cont}=\frac{X_{exp}}{N_{exp}}-\frac{X_{cont}}{N_{cont}}=0.0049$
$\hat{p}_{pool}=\frac{X_{cont}+X_{exp}}{N_{cont}+N_{exp}}=0.1151$
因此有合并标准误差：
$SE_{pool}=\sqrt{\hat{p}_{pool}*(1-\hat{p}_{pool})*(\frac{1}{N_{cont}}+\frac{1}{N_{exp}})}=0.00343$
$\alpha=0.05$的Z临界值为$Z^*=1.96$
置信区间$\hat{d}\pm Z^**SE_{pool}$为$(-0.0116,0.0019)$
由于$d=0$落在置信区间内，因此我们维持零假说，实验组和对照组之间没有统计显著性。
在评估指标期望里，我们对净转化率的期望是不降低，即不希望观察到阴性的统计显著性，并且希望看到至少0.75%的最小变化，但我们置信区间既不全大于0.0075，也不全小于-0.0075，因此对于净转化率我们的试验既没有统计显著性也没有实际显著性。

####符号检验
利用[在线计算器](https://www.graphpad.com/quickcalcs/binomial1.cfm)对评估指标进行符号检验。
* **总转化率：**
通过统计样本数据，我们发现在23天里，实验组比对照组的总转化率要小的天数为19天，利用在线计算器可得其双尾检验的$P_{value}=0.0026$，由于我们的$\alpha=0.05$，而$P_{value}<\alpha$，因此总转化率在符号检验里具有统计显著性。

* **净转化率**
通过统计样本数据，我们发现在23天里，实验组比对照组的总转化率要大的天数为10天，利用在线计算器可得其双尾检验的$P_{value}=0.6776$，由于我们的$\alpha=0.05$，而$P_{value}>\alpha$，因此净转化率在符号检验里并不具有统计显著性。

####汇总
在结果分析里，测试分析里的效应大小检验和符号检验在总转化率和净转化率上相同。检验并没有使用Bonferroni校正，因为我们希望这两个评估指标同时满足期望，而这两个指标之间也存在相关性（登陆用户id数量的变化可能会影响付费用户数量），如果使用了 Bonferroni校正会显得较保守。

建议
---
---
本次测试的结果分析与我们试验期望的对比如下：
* **总转化率：**置信区间$(-0.0291,-0.012)$既小于0，也小于我们希望看到的负向最小变化0.01，具有明显的阴性显著性，这符合我们对总转化率会降低的期望。

* **净转化率：**置信区间$(-0.0116,0.0019)$虽然没有统计显著性和实际统计性，但也有部分区间小于的负向的最小变化0.0075，也就是说有一定概率会观察到净转化率减少超过0.0075，不符合我们不希望看到净转化率会降低的期望。

由于在本次测试里，我们对净转化率这一指标还存有疑问，因为新功能可能会有一定概率会使付费用户有显著性减少，这不是我们希望看到的，因此建议不发布“免费试学筛选器”这一新功能。

后续试验
---
---
在本次试验里，我们并没有得出期望的结论，其中有一个原因是有部分用户在点击按钮回答筛选器的问题时，并不清楚自己是否可以在每周花5小时的时间来进行学习，错误地排除了一些能坚持完成课程但担心没时间完成的用户，或者没足够时间完成课程但错误估计自己学习时间的用户。同时为了弄清楚本次试验里对留存率的疑问，因此后续的试验应该着眼于对已登录“开始免费试学”的用户，基于这些用户去测试用户能否清楚了解自己的学习时间是否达到课程要求。

为了提高用户的体验，需要及早调动用户的学习积极性，我建议开展一个后续试验，引流单位为“注册开始免费试学用户id”，试验样本分为两组，对照组在用户登陆“开始免费试学”后，他们将进入付费课程版本的免费试学正常流程，即14天后，将对他们自动收费，除非他们在此期限结束前取消试用。实验组在用户登陆“开始免费试学”后，同样可以进行免费试学的所有内容，但在每天登陆免费试学页面时，会弹出一个签到页面（每天只弹出一次，包括第一次完成注册并浏览内容时），提示用户今天是否能坚持学习1小时，并鼓励用户每周只需要至少投入5小时就能顺利完成本课程。如果这个假设为真，鼓励用户会使他们更好养成每天学习的习惯，并更能坚持完成免费课程（但最后付费用户可能因为其他因素而不会有显著提高）。

在后续试验里，不变指标是：
* **免费试学用户id数量：**即注册开始免费试学的用户id数，作为后续试验的引流单位，能够随机分配到对照组和实验组，是个很好的总体规模不变指标。
* **点击次数：**即点击“开始免费试学”的唯一cookie数量，事件发生在试验之前，作为获得用户id数之前的一个事件，是个很好的总体规模不变指标。

评估指标是：
* **留存率：**即完成免费课程后继续付费的用户id数量除以注册免费试学的用户id数量，这个指标会受到签到页面的影响，用户会了解到付费课程的投入要求而清楚自己是否应该进行付费，是个很好的评估指标。基于业务考虑，我们不希望付费用户减少，因此这个指标的期望是不减少。
* **第一周主动注销率：**即完成注册后到第7天结束前主动取消试学用户id数除以注册免费试学用户id数，这个指标会受到签到页面的影响，用户可能会受到鼓励而坚持学习到第二周。分子希望降低，分母是不变量，因此这个指标期望能降低。
* **净转化率：**即完成免费课程并付费的用户id数量除以点击“开始免费试学”的唯一cookie数，分子不希望减少，分母是不变量，这个指标同样并不希望降低。